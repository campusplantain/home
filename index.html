<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Food & Snacks Order</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
      :root {
          --primary: #ff7043;
          --background: #f5f5f7;
          --card: #fff;
          --accent: #ffd180;
          --shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
          --radius: 16px;
      }
      * {
          box-sizing: border-box;
      }
      body {
          margin: 0;
          font-family: "Inter", sans-serif;
          background: var(--background);
          color: #222;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
      }
      header {
          background: var(--card);
          box-shadow: var(--shadow);
          padding: 1rem 2rem;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          position: sticky;
          top: 0;
          z-index: 2;
      }
      .logo {
          font-size: 2rem;
          font-weight: 700;
          color: var(--primary);
          margin: 0;
          letter-spacing: 1px;
          animation: popIn 0.6s cubic-bezier(0.46, 0.03, 0.52, 0.96);
      }
      nav button {
          background: var(--primary);
          color: #fff;
          border: none;
          border-radius: var(--radius);
          padding: 0.5rem 1.2rem;
          font-size: 1rem;
          cursor: pointer;
          font-weight: bold;
          box-shadow: var(--shadow);
          transition: transform 0.1s;
      }
      nav button:active {
          transform: scale(0.95);
      }
      nav .auth-user {
          margin-right: 1rem;
          color: #333;
          font-weight: bold;
      }
      main {
          max-width: 1200px;
          margin: 0 auto;
          flex: 1 0 auto;
      }
      .menu {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
          gap: 2rem;
          padding: 2rem;
      }
      .card {
          background: var(--card);
          border-radius: var(--radius);
          box-shadow: var(--shadow);
          padding: 1.5rem 7rem 1rem 7rem;
          display: flex;
          flex-direction: column;
          align-items: center;
          animation: fadeInUp 0.7s cubic-bezier(0.46, 0.03, 0.52, 0.96);
          position: relative;
          overflow: hidden;
      }
      .card img {
          width: 120px;
          height: 120px;
          object-fit: cover;
          border-radius: 50%;
          margin-bottom: 1rem;
          transition: transform 0.3s;
          cursor: pointer;
      }
      .card:hover img {
          transform: scale(1.1) rotate(-4deg);
      }
      .card h3 {
          margin: 0.2rem 0 0.5rem 0;
          font-size: 1.3rem;
          color: var(--primary);
          text-align: center;
          white-space: nowrap;
      }
      .card p {
          font-size: 0.95rem;
          color: #555;
          margin: 0 0 0.8rem 0;
          text-align: center;
      }
      .card .price {
          font-size: 1.1rem;
          font-weight: bold;
          color: #222;
          margin-bottom: 1rem;
      }
      .card button {
          background: var(--accent);
          color: #222;
          border: none;
          border-radius: 12px;
          padding: 0.4rem 1.2rem;
          font-size: 1rem;
          cursor: pointer;
          transition: background 0.2s;
          font-weight: 600;
          box-shadow: 0 2px 8px rgba(255, 112, 67, 0.1);
      }
      .card button:hover {
          background: var(--primary);
          color: #fff;
      }
      .cart-modal,
      .order-confirm,
      .auth-modal,
      .image-preview-modal {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.25);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 999;
          animation: fadeIn 0.3s;
      }
      .cart-modal.active,
      .order-confirm.active,
      .auth-modal.active,
      .image-preview-modal.active {
          display: flex;
      }
      .cart-content,
      .order-box,
      .auth-box,
      .image-preview-box {
          background: var(--card);
          border-radius: var(--radius);
          max-width: 400px;
          width: 95vw;
          box-shadow: var(--shadow);
          padding: 2rem 1.5rem 1rem 1.5rem;
          animation: scaleIn 0.4s cubic-bezier(0.46, 0.03, 0.52, 0.96);
      }
      .cart-content h2,
      .order-box h2,
      .auth-box h2 {
          margin-top: 0;
          color: var(--primary);
          font-size: 1.4rem;
      }
      #cart-list {
          list-style: none;
          padding: 0;
          margin: 0 0 1rem 0;
          max-height: 260px;
          overflow-y: auto;
      }
      #cart-list li {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.7rem;
          font-size: 1rem;
          animation: fadeInUp 0.5s;
          gap: 0.7rem;
      }
      #cart-list .cart-img-thumb {
          width: 50px;
          height: 50px;
          border-radius: 8px;
          object-fit: cover;
          margin-right: 0.35rem;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.07);
          cursor: pointer;
          border: 2px solid var(--background);
          transition: border 0.2s;
      }
      #cart-list .cart-img-thumb:hover {
          border: 2px solid var(--primary);
      }
      #cart-list .cart-item-details {
          flex: 1 1 auto;
          display: flex;
          flex-direction: column;
          min-width: 0;
      }
      #cart-list .cart-item-title {
          font-weight: 600;
          color: #222;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }
      #cart-list .cart-item-qty-row {
          display: flex;
          align-items: center;
          gap: 0.3em;
      }
      #cart-list .cart-item-qty {
          font-size: 0.98em;
          color: #888;
          min-width: 2.2em;
          text-align: center;
      }
      #cart-list .cart-qty-btn {
          background: var(--accent);
          border: none;
          border-radius: 5px;
          font-size: 1.1em;
          padding: 0.1em 0.45em;
          color: #333;
          cursor: pointer;
          font-weight: bold;
          transition: background 0.18s;
      }
      #cart-list .cart-qty-btn:hover {
          background: var(--primary);
          color: #fff;
      }
      #cart-list .cart-item-price {
          font-weight: 500;
          color: #222;
      }
      #cart-list .remove-btn {
          background: none;
          color: var(--primary);
          border: none;
          font-size: 1.1rem;
          cursor: pointer;
          margin-left: 0.7rem;
          font-weight: bold;
      }
      .cart-total {
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          font-size: 1.1rem;
          margin-bottom: 1.5rem;
      }
      #order-btn {
          width: 100%;
          background: var(--primary);
          color: #fff;
          padding: 0.7rem 0;
          border-radius: 10px;
          font-size: 1.1rem;
          border: none;
          font-weight: bold;
          cursor: pointer;
          margin-bottom: 0.7rem;
          transition: background 0.2s;
      }
      #order-btn:hover {
          background: #ff5722;
      }
      #close-cart,
      #close-confirm,
      #close-auth,
      #close-preview {
          width: 100%;
          background: var(--accent);
          color: #222;
          border: none;
          border-radius: 10px;
          padding: 0.5rem 0;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          margin-top: 0.2rem;
      }
      #close-cart:hover,
      #close-confirm:hover,
      #close-auth:hover,
      #close-preview:hover {
          background: #ffe0b2;
      }
      .auth-tabs {
          display: flex;
          margin-bottom: 1rem;
      }
      .auth-tabs button {
          flex: 1;
          padding: 0.5rem;
          border: none;
          background: var(--background);
          color: #222;
          font-weight: bold;
          cursor: pointer;
          border-radius: 10px 10px 0 0;
          border-bottom: 2px solid transparent;
          font-size: 1rem;
          transition:
              background 0.2s,
              border-bottom 0.2s;
      }
      .auth-tabs button.active {
          background: var(--card);
          color: var(--primary);
          border-bottom: 2px solid var(--primary);
      }
      .auth-form {
          display: flex;
          flex-direction: column;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 10px
          

      }
      .auth-form input[type="email"],
      .auth-form input[type="password"],
      .auth-form input[type="text"],
      .auth-form input[type="tel"] {
          padding: 0.6rem;
          border-radius: 8px;
          border: 1px solid #ddd;
          font-size: 1rem;
          margin: 0 auto;
      }
      .auth-form button[type="submit"] {
          background: var(--primary);
          color: #fff;
          border: none;
          border-radius: 8px;
          padding: 0.6rem 0;
          font-size: 1rem;
          font-weight: bold;
          cursor: pointer;
          padding: 7px 10px;
      }
      .auth-form button[type="submit"]:hover {
          background: #ff5722;
      }
      .auth-error {
          color: #d32f2f;
          font-size: 0.98rem;
          margin-bottom: 0.6rem;
          text-align: center;
      }

      .image-preview-box {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 1.5rem;
          max-width: 90vw;
          max-height: 90vh;
      }
      .image-preview-box img {
          max-width: 65vw;
          max-height: 60vh;
          border-radius: 20px;
          margin-bottom: 1rem;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
          background: #fff;
          display: block;
      }
      .image-preview-title {
          font-size: 1.15rem;
          font-weight: 600;
          color: var(--primary);
          margin-bottom: 0.5rem;
          text-align: center;
      }
      footer {
          background: #232323;
          color: #fff;
          text-align: center;
          padding: 1.2rem 0 0.7rem 0;
          font-size: 1rem;
          letter-spacing: 0.5px;
          flex-shrink: 0;
      }
      .footer-social {
          margin: 0.6rem auto 0.4rem auto;
          display: flex;
          justify-content: center;
          gap: 1.4rem;
      }
      .footer-social a {
          color: #fff;
          text-decoration: none;
          font-size: 1.45rem;
          transition: color 0.2s;
          line-height: 1;
      }
      .footer-social a:hover {
          color: var(--primary);
      }
      @keyframes popIn {
          from {
              opacity: 0;
              transform: scale(0.8);
          }
          to {
              opacity: 1;
              transform: scale(1);
          }
      }
      @keyframes fadeInUp {
          from {
              opacity: 0;
              transform: translateY(32px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }
      @keyframes fadeIn {
          from {
              opacity: 0;
          }
          to {
              opacity: 1;
          }
      }
      @keyframes scaleIn {
          from {
              opacity: 0;
              transform: scale(0.8);
          }
          to {
              opacity: 1;
              transform: scale(1);
          }
      }
      @media (max-width: 600px) {
          .menu {
              grid-template-columns: 1fr;
              padding: 1rem;
          }
          .cart-content,
          .order-box,
          .auth-box,
          .image-preview-box {
              padding: 1rem 0.5rem 0.5rem 0.5rem;
          }
          .image-preview-box img {
              max-width: 95vw;
          }
      }
    </style>
  </head>
  <body>
    <header>
      <h1 class="logo">🍔 Campus Plantain</h1>
      <nav>
        <button id="auth-btn">Sign In</button>
        <button id="cart-btn">🛒 Cart (<span id="cart-count">0</span>)</button>
      </nav>
      <span class="auth-user" id="auth-user"></span>
    </header>
    <main>
      <section class="menu" id="menu"></section>
    </main>
    <div class="cart-modal" id="cart-modal">
      <div class="cart-content">
        <h2>Your Cart</h2>
        <ul id="cart-list"></ul>
        <div class="cart-total">
          <span>Total:</span> <span id="cart-total">₵0.00</span>
        </div>
        <button id="order-btn">Order Now</button>
        <button id="close-cart">Close</button>
      </div>
    </div>
    <div class="order-confirm" id="order-confirm">
      <div class="order-box">
        <h2>Order Placed! 🎉</h2>
        <p>Thank you for your purchase.</p>
        <button id="close-confirm">Close</button>
      </div>
    </div>
    <div class="auth-modal" id="auth-modal">
      <div class="auth-box">
        <h2 id="auth-title">Sign In</h2>
        <div class="auth-tabs">
          <button id="tab-signin" class="active">Sign In</button>
          <button id="tab-signup">Sign Up</button>
        </div>
        <form id="signin-form" class="auth-form" style="display: block">
          <input
            type="email"
            id="signin-email"
            placeholder="Email"
            required
            autocomplete="username" />
          <input
            type="password"
            id="signin-password"
            placeholder="Password"
            required
            autocomplete="current-password" />
          <div class="auth-error" id="signin-error"></div>
          <button type="submit">Sign In</button>
        </form>
        <form id="signup-form" class="auth-form" style="display: none">
          <input
            type="email"
            id="signup-email"
            placeholder="Email"
            required
            autocomplete="username" />
          <input
            type="password"
            id="signup-password"
            placeholder="Password"
            required
            autocomplete="new-password" />
          <input
            type="text"
            id="signup-displayname"
            placeholder="Display Name"
            required
            autocomplete="name" />
          <input
            type="tel"
            id="signup-phone"
            placeholder="Phone Number"
            required
            autocomplete="tel" />
          <input
            type="text"
            id="signup-location"
            placeholder="Location (e.g. Hall, Hostel, Room)"
            required
            autocomplete="address-line1" />
          <div class="auth-error" id="signup-error"></div>
          <button type="submit">Sign Up</button>
        </form>
        <button id="close-auth">Close</button>
      </div>
    </div>
    <div class="image-preview-modal" id="image-preview-modal">
      <div class="image-preview-box">
        <div class="image-preview-title" id="preview-title"></div>
        <img id="preview-img" src="" alt="Preview" />
        <button id="close-preview">Close</button>
      </div>
    </div>
    <footer>
      <div>&copy; 2025 Campus Plantain. All rights reserved.</div>
    </footer>
    <script>
      // ---- Supabase Setup ----
      // Replace with your own Supabase project credentials!
      const SUPABASE_URL = "https://soxfqyzgbkbxpjkvxvvi.supabase.co";
      const SUPABASE_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNveGZxeXpnYmtieHBqa3Z4dnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzNjQ1MTAsImV4cCI6MjA2Mzk0MDUxMH0.kxV61t2xqauvO-wYyUMIrmNUKow99kjG09JdGXjsO6c";
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      let MENU_ITEMS = [];
      let cart = [];
      let currentUser = null;

      // Fetch Menu Items from Supabase
      async function fetchMenuItems() {
        const { data, error } = await supabase
          .from("menu_items")
          .select("*")
          .order("id", { ascending: true });
        if (error) {
          alert("Failed to load menu: " + (error.message || error));
          MENU_ITEMS = [];
        } else {
          MENU_ITEMS = data || [];
        }
        updateMenu();
      }

      // Menu Rendering
      function updateMenu() {
        const menu = document.getElementById("menu");
        menu.innerHTML = "";
        if (MENU_ITEMS.length === 0) {
          menu.innerHTML =
            '<div style="text-align:center; grid-column: 1/-1; color: #bbb; font-size: 1.3rem;">No menu items available.</div>';
          return;
        }
        MENU_ITEMS.forEach((item) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
                        <img src="${item.img}" alt="${
            item.title
          }" data-preview="${item.img}" data-title="${item.title}">
                        <h3>${item.title}</h3>
                        <p>${item.desc}</p>
                        <div class="price">₵${Number(item.price).toFixed(
                          2
                        )}</div>
                        <button data-id="${item.id}">Add to Cart</button>
                    `;
          card
            .querySelector("button")
            .addEventListener("click", () => addToCart(item.id));
          // Enable preview on card image
          card.querySelector("img").addEventListener("click", (e) => {
            showImagePreview(item.img, item.title);
          });
          menu.appendChild(card);
        });
      }

      function addToCart(id) {
        const item = MENU_ITEMS.find((x) => x.id === id);
        if (!item) return;
        const existing = cart.find((x) => x.id === id);
        if (existing) {
          existing.qty += 1;
        } else {
          cart.push({ ...item, qty: 1 });
        }
        animateCart();
        updateCartCount();
      }

      function animateCart() {
        const cartBtn = document.getElementById("cart-btn");
        cartBtn.style.transform = "scale(1.15)";
        setTimeout(() => {
          cartBtn.style.transform = "";
        }, 200);
      }

      function updateCartCount() {
        document.getElementById("cart-count").innerText = cart.reduce(
          (sum, i) => sum + i.qty,
          0
        );
      }

      function openCart() {
        renderCart();
        document.getElementById("cart-modal").classList.add("active");
      }

      function closeCart() {
        document.getElementById("cart-modal").classList.remove("active");
      }

      function renderCart() {
        const cartList = document.getElementById("cart-list");
        cartList.innerHTML = "";
        if (cart.length === 0) {
          cartList.innerHTML = `<li style="text-align:center; color:#bbb;">Cart is empty.</li>`;
        } else {
          cart.forEach((item) => {
            const li = document.createElement("li");
            li.innerHTML = `
                            <img src="${item.img}" alt="${
              item.title
            }" class="cart-img-thumb" data-preview="${item.img}" data-title="${
              item.title
            }" tabindex="0"/>
                            <div class="cart-item-details">
                              <span class="cart-item-title">${item.title}</span>
                              <div class="cart-item-qty-row">
                                <button class="cart-qty-btn" data-action="decrease" data-id="${
                                  item.id
                                }" aria-label="Decrease quantity">-</button>
                                <span class="cart-item-qty">${item.qty}</span>
                                <button class="cart-qty-btn" data-action="increase" data-id="${
                                  item.id
                                }" aria-label="Increase quantity">+</button>
                              </div>
                            </div>
                            <span class="cart-item-price">₵${(
                              item.price * item.qty
                            ).toFixed(2)}</span>
                            <button class="remove-btn" title="Remove" data-id="${
                              item.id
                            }">✕</button>
                        `;
            // Add click/keyboard preview for image
            li.querySelector(".cart-img-thumb").addEventListener("click", (e) =>
              showImagePreview(item.img, item.title)
            );
            li.querySelector(".cart-img-thumb").addEventListener(
              "keypress",
              (e) => {
                if (e.key === "Enter" || e.key === " ") {
                  showImagePreview(item.img, item.title);
                }
              }
            );
            // Increase and decrease qty
            li.querySelector(
              '.cart-qty-btn[data-action="increase"]'
            ).addEventListener("click", () => {
              changeCartQty(item.id, 1);
            });
            li.querySelector(
              '.cart-qty-btn[data-action="decrease"]'
            ).addEventListener("click", () => {
              changeCartQty(item.id, -1);
            });
            // Remove
            li.querySelector(".remove-btn").addEventListener("click", () => {
              removeFromCart(item.id);
            });
            cartList.appendChild(li);
          });
        }
        updateCartTotal();
      }

      function changeCartQty(id, delta) {
        const item = cart.find((x) => x.id === id);
        if (!item) return;
        item.qty += delta;
        if (item.qty <= 0) {
          cart = cart.filter((x) => x.id !== id);
        }
        renderCart();
        updateCartCount();
      }

      function removeFromCart(id) {
        cart = cart.filter((x) => x.id !== id);
        renderCart();
        updateCartCount();
      }

      function updateCartTotal() {
        const total = cart.reduce(
          (sum, item) => sum + item.price * item.qty,
          0
        );
        document.getElementById("cart-total").innerText = `₵${total.toFixed(
          2
        )}`;
      }

      function showImagePreview(img, title) {
        document.getElementById("preview-img").src = img;
        document.getElementById("preview-title").innerText = title;
        document.getElementById("image-preview-modal").classList.add("active");
      }

      function closeImagePreview() {
        document
          .getElementById("image-preview-modal")
          .classList.remove("active");
        document.getElementById("preview-img").src = "";
        document.getElementById("preview-title").innerText = "";
      }

      // Auth Modal Logic
      function openAuthModal(defaultTab = "signin") {
        document.getElementById("auth-modal").classList.add("active");
        switchAuthTab(defaultTab);
      }

      function closeAuthModal() {
        document.getElementById("auth-modal").classList.remove("active");
        clearAuthForms();
      }

      function switchAuthTab(tab) {
        document
          .getElementById("tab-signin")
          .classList.toggle("active", tab === "signin");
        document
          .getElementById("tab-signup")
          .classList.toggle("active", tab === "signup");
        document.getElementById("signin-form").style.display =
          tab === "signin" ? "block" : "none";
        document.getElementById("signup-form").style.display =
          tab === "signup" ? "block" : "none";
        document.getElementById("auth-title").innerText =
          tab === "signin" ? "Sign In" : "Sign Up";
      }

      function clearAuthForms() {
        document.getElementById("signin-email").value = "";
        document.getElementById("signin-password").value = "";
        document.getElementById("signup-email").value = "";
        document.getElementById("signup-password").value = "";
        document.getElementById("signup-displayname").value = "";
        document.getElementById("signup-phone").value = "";
        document.getElementById("signup-location").value = "";
        document.getElementById("signin-error").innerText = "";
        document.getElementById("signup-error").innerText = "";
      }
      async function handleSignIn(e) {
        e.preventDefault();
        const email = document.getElementById("signin-email").value;
        const password = document.getElementById("signin-password").value;
        document.getElementById("signin-error").innerText = "";
        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        if (error) {
          document.getElementById("signin-error").innerText = error.message;
        } else {
          currentUser = data.user;
          updateAuthUserUI();
          closeAuthModal();
        }
      }

      async function handleSignUp(e) {
        e.preventDefault();
        const email = document.getElementById("signup-email").value;
        const password = document.getElementById("signup-password").value;
        const displayName = document.getElementById("signup-displayname").value;
        const phone = document.getElementById("signup-phone").value;
        const location = document.getElementById("signup-location").value;
        document.getElementById("signup-error").innerText = "";

        // Pass display name, phone, and location as user_metadata to Supabase
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: {
              display_name: displayName,
              phone: phone,
              location: location,
            },
          },
        });
        if (error) {
          document.getElementById("signup-error").innerText = error.message;
        } else {
          currentUser = data.user;
          updateAuthUserUI();
          closeAuthModal();
        }
      }

      function updateAuthUserUI() {
        const userBox = document.getElementById("auth-user");
        if (currentUser && currentUser.email) {
          let name =
            currentUser.user_metadata && currentUser.user_metadata.display_name
              ? currentUser.user_metadata.display_name
              : currentUser.email;
          userBox.innerText = `Signed in as: ${name}`;
          document.getElementById("auth-btn").innerText = "Sign Out";
        } else {
          userBox.innerText = "";
          document.getElementById("auth-btn").innerText = "Sign In";
        }
      }

      async function handleAuthBtn() {
        if (currentUser) {
          // Sign out
          await supabase.auth.signOut();
          currentUser = null;
          updateAuthUserUI();
        } else {
          openAuthModal("signin");
        }
      }

      // Order Logic
      async function handleOrder() {
        if (!currentUser) {
          openAuthModal("signin");
          return;
        }
        if (cart.length === 0) {
          alert("Cart is empty.");
          return;
        }
        // Save order to Supabase
        const { error } = await supabase.from("orders").insert([
          {
            email: currentUser.email,
            user_display_name:
              currentUser.user_metadata &&
              currentUser.user_metadata.display_name
                ? currentUser.user_metadata.display_name
                : "",
            user_phone:
              currentUser.user_metadata && currentUser.user_metadata.phone
                ? currentUser.user_metadata.phone
                : "",
            user_location:
              currentUser.user_metadata && currentUser.user_metadata.location
                ? currentUser.user_metadata.location
                : "",
            items: cart.map((item) => ({
              id: item.id,
              title: item.title,
              price: item.price,
              qty: item.qty,
            })),
            total: cart.reduce((sum, item) => sum + item.price * item.qty, 0),
          },
        ]);
        if (error) {
          alert("Failed to place order: " + error.message);
        } else {
          cart = [];
          updateCartCount();
          closeCart();
          showOrderConfirm();
        }
      }

      function showOrderConfirm() {
        document.getElementById("order-confirm").classList.add("active");
      }

      function closeOrderConfirm() {
        document.getElementById("order-confirm").classList.remove("active");
      }

      // Event Listeners
      document.getElementById("cart-btn").addEventListener("click", openCart);
      document
        .getElementById("close-cart")
        .addEventListener("click", closeCart);
      document
        .getElementById("auth-btn")
        .addEventListener("click", handleAuthBtn);
      document
        .getElementById("close-auth")
        .addEventListener("click", closeAuthModal);
      document
        .getElementById("close-confirm")
        .addEventListener("click", closeOrderConfirm);
      document
        .getElementById("close-preview")
        .addEventListener("click", closeImagePreview);
      document
        .getElementById("order-btn")
        .addEventListener("click", handleOrder);

      // Auth Tabs
      document
        .getElementById("tab-signin")
        .addEventListener("click", () => switchAuthTab("signin"));
      document
        .getElementById("tab-signup")
        .addEventListener("click", () => switchAuthTab("signup"));
      document
        .getElementById("signin-form")
        .addEventListener("submit", handleSignIn);
      document
        .getElementById("signup-form")
        .addEventListener("submit", handleSignUp);

      // Close modals on overlay click
      document
        .querySelectorAll(
          ".cart-modal, .order-confirm, .auth-modal, .image-preview-modal"
        )
        .forEach((modal) => {
          modal.addEventListener("click", function (e) {
            if (e.target === modal) {
              modal.classList.remove("active");
              if (modal === document.getElementById("image-preview-modal")) {
                closeImagePreview();
              }
            }
          });
        });

      // Supabase Auth state listener
      supabase.auth.getUser().then(({ data: { user } }) => {
        currentUser = user;
        updateAuthUserUI();
      });

      // Initialize
      fetchMenuItems();
      updateCartCount();
    </script>
  </body>
</html>
